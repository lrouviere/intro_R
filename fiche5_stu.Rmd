---
title: "Faire des cartes avec leaflet"
output: 
  html_notebook:
#    toc: true
#    toc_float: true
---

<style type="text/css">

body{ /* Normal  */
      font-size: 12px;
  }
td {  /* Table  */
  font-size: 12px;
}
h1.title {
  font-size: 48px;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 35px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 28px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 24px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>



Leaflet est un package **R** qui permet de faire des cartes intéractives.On pourra trouver de l'information [ici](https://rstudio.github.io/leaflet/)). On peut obtenir un premier fond de carte avec


```{r}
library(leaflet)
m <- leaflet()
m <- addTiles(m)
m
```

Il est possible d'utiliser l'opérateur **pipe** de **dplyr**
```{r message=FALSE, warning=FALSE}
library(tidyverse)
leaflet()%>%addTiles()
```

Plusieurs types de fonds de carte sont disponibles (quelques exemples [ici](http://leaflet-extras.github.io/leaflet-providers/preview/)). Par exemple

```{r}
Paris <- c(2.35222,48.856614)
m2 <- leaflet() %>% setView(lng = Paris[1], lat = Paris[2], zoom = 12) %>% addTiles(urlTemplate = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
m2 %>% addProviderTiles("Stamen.Toner")
m2 %>% addProviderTiles("Stamen.Toner")
m2%>% addProviderTiles("OpenStreetMap.BlackAndWhite")
m2%>% addProviderTiles("Thunderforest.Transport")
```

**addMarkers** et **addCircles** permettent d'ajouter des marqueurs sur la carte :

```{r}
data(quakes)
leaflet(data = quakes[1:20,]) %>% addTiles(urlTemplate = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png") %>%
  addMarkers(~long, ~lat, popup = ~as.character(mag))
```

On peut observer qu'on utilise le caractère **~** lorsqu'on fait référence à des noms de variables du jeu de données.

Il est assez assez facile d'ajouter des Popups pour des informations plus précises :

```{r}
content <- paste(sep = "<br/>",
  "<b><a href='http://www.samurainoodle.com'>Samurai Noodle</a></b>",
  "606 5th Ave. S",
  "Seattle, WA 98138"
)

leaflet() %>% addTiles(urlTemplate = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png") %>%
  addPopups(-122.327298, 47.597131, content,
    options = popupOptions(closeButton = FALSE)
  )
```

### Exercice 1

Mettre un Popup sur une carte leaflet pour localiser le site de la DRESS. Ajouter sur ce popup le site web de la DRESS. On pourra obtenir les coordonnées GPS souhaitées à cette [url](https://www.coordonnees-gps.fr).






### Exercice 2: velib Paris

1. Importer les  [données](https://opendata.paris.fr/explore/dataset/velib-disponibilite-en-temps-reel/export/)



2. Décrire les variables du jeu de données.


3. Créer les une variable **latitude** et une variable **longitude** à partir de la variable **geo**.


4. Supprimer les lignes où les latitudes et longitudes sont manquantes.


5. Visualiser les positions des stations sur une carte leaflet.


6. Ajouter un popup qui permet de connaitre le nombre de vélos disponibles (électriques+mécanique) quand on clique sur la station (on pourra utiliser l'option **popup** dans la fonction **addCircleMarkers**).


7. Ajouter la nom de la station dans le popup.



8. Visualiser les stations à l'aide de points de différentes tailles, la taille représentera la proportion de vélos disponibles dans la station
(**=numBikesAvailable / capacity**).



